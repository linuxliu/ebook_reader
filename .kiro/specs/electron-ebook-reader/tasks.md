# 实施计划

- [x] 1. 项目初始化和基础架构搭建
  - 创建 Electron + React + TypeScript 项目结构
  - 配置 Webpack、Babel、ESLint 等开发工具
  - 设置主进程和渲染进程的基础文件
  - 配置 Tailwind CSS 和基础样式系统
  - _需求: 10.1, 10.5_

- [x] 2. 数据模型和 TypeScript 接口定义
  - 创建所有数据模型的 TypeScript 接口（BookMetadata、ReadingProgress、VocabularyItem 等）
  - 定义服务层接口（FileSystemService、DatabaseService、CacheService）
  - 实现错误类型定义和错误处理接口
  - 创建 IPC 通信的消息类型定义
  - _需求: 1.3, 2.1, 4.1, 6.2, 7.4_

- [x] 3. SQLite 数据库服务实现
  - 安装和配置 better-sqlite3 依赖
  - 创建数据库初始化脚本和表结构
  - 实现 DatabaseService 的所有方法（书籍管理、进度保存、生词表、设置）
  - 编写数据库服务的单元测试
  - 实现数据库迁移和版本管理
  - _需求: 1.4, 2.2, 4.2, 6.1, 7.4_

- [x] 4. 文件系统服务和电子书解析器
- [x] 4.1 基础文件系统服务
  - 实现文件导入功能和文件类型验证
  - 创建安全的文件路径处理工具
  - 实现文件元信息提取功能
  - _需求: 1.1, 1.2, 1.5_

- [x] 4.2 EPUB 解析器集成
  - 集成 epub.js 库解析 EPUB 格式
  - 实现 EPUB 元信息提取（标题、作者、封面）
  - 实现 EPUB 内容解析和章节分割
  - 编写 EPUB 解析器的单元测试
  - _需求: 1.2, 1.3_

- [x] 4.3 PDF 解析器集成
  - 集成 pdf.js 库解析 PDF 格式
  - 实现 PDF 文本提取和页面分割
  - 实现 PDF 元信息提取
  - 处理 PDF 特殊格式和编码问题
  - _需求: 1.2, 1.3_

- [x] 4.4 TXT 和 MOBI 解析器
  - 实现 TXT 文件解析和编码检测
  - 创建简单的 MOBI 解析器或集成第三方库
  - 实现统一的内容格式化接口
  - _需求: 1.2, 1.3_

- [x] 5. 缓存管理系统
  - 实现 CacheService 的核心功能
  - 创建缓存文件的生成和读取逻辑
  - 实现缓存版本管理和失效机制
  - 实现缓存清理和空间管理功能
  - 编写缓存系统的单元测试
  - _需求: 2.1, 2.2, 2.3, 2.4, 2.5_

- [x] 6. IPC 通信层实现
  - 创建主进程的 IPC 处理器
  - 实现渲染进程的 IPC 客户端
  - 定义所有 IPC 消息类型和处理逻辑
  - 实现错误处理和超时机制
  - 编写 IPC 通信的集成测试
  - _需求: 1.1, 2.1, 4.1, 5.1, 6.1, 7.1_

- [x] 7. React 应用状态管理
  - 创建全局状态管理（Context + useReducer）
  - 实现状态更新的 actions 和 reducers
  - 创建自定义 hooks 用于状态访问
  - 实现状态持久化逻辑
  - _需求: 4.1, 7.4, 9.2_

- [-] 8. 书架界面组件开发
- [x] 8.1 书架布局和基础组件
  - 创建书架主界面组件
  - 实现网格和列表视图切换
  - 创建书籍卡片组件显示封面和元信息
  - 实现响应式布局适配
  - _需求: 8.1, 8.2_

- [x] 8.2 搜索和排序功能
  - 实现搜索框组件和实时过滤逻辑
  - 创建排序选项组件（标题、作者、日期）
  - 实现搜索结果高亮显示
  - 处理搜索无结果的情况
  - _需求: 8.4, 8.5, 8.3_

- [x] 8.3 书籍导入界面
  - 创建导入按钮和文件选择对话框
  - 实现导入进度显示和错误处理
  - 创建导入成功/失败的用户反馈
  - _需求: 1.1, 1.5_

- [-] 9. 阅读器核心组件
- [x] 9.1 基础阅读器界面
  - 创建阅读器主组件和布局
  - 实现内容显示区域和基础样式
  - 创建翻页控制组件（按钮、键盘、鼠标滚轮）
  - 实现全屏模式切换
  - _需求: 3.1, 3.2, 3.5_

- [x] 9.2 目录和导航功能
  - 创建目录侧边栏组件
  - 实现章节列表显示和跳转功能
  - 创建页码输入和跳转组件
  - 实现阅读进度条显示
  - _需求: 3.3, 3.4_

- [x] 9.3 阅读进度管理
  - 实现阅读位置的自动检测和记录
  - 创建进度保存和恢复逻辑
  - 实现多书籍进度的独立管理
  - 处理进度数据异常情况
  - _需求: 4.1, 4.2, 4.3, 4.4, 4.5_

- [x] 10. 字体和显示设置
- [x] 10.1 设置界面组件
  - 创建设置面板组件
  - 实现字体选择下拉菜单
  - 创建字号调整滑块（12px-32px，步长2px）
  - 实现行间距和边距调整控件
  - _需求: 7.1, 7.2, 7.3_

- [x] 10.2 设置应用和持久化
  - 实现设置的实时预览功能
  - 创建设置与书籍的绑定逻辑
  - 实现设置的保存和加载
  - 处理设置数据的版本兼容性
  - _需求: 7.4, 7.5_

- [x] 11. 划词翻译功能
- [x] 11.1 文本选择和检测
  - 实现文本选择事件监听
  - 创建选中文本的提取和处理逻辑
  - 实现选择区域的位置计算
  - _需求: 5.1_

- [x] 11.2 翻译服务集成
  - 集成有道词典 API 或其他翻译服务
  - 实现本地词典数据库作为备选
  - 创建翻译请求的缓存机制
  - 处理网络错误和 API 限制
  - _需求: 5.2, 5.5_

- [x] 11.3 翻译窗口组件
  - 创建翻译结果显示的悬浮窗口
  - 实现窗口位置的自动调整逻辑
  - 创建"加入生词表"按钮
  - 实现点击外部关闭窗口功能
  - _需求: 5.2, 5.3, 5.4_

- [x] 12. 生词表管理功能
- [x] 12.1 生词表界面组件
  - 创建生词表主界面
  - 实现生词列表的显示和分页
  - 创建生词项的详细信息显示
  - 实现按时间和字母排序功能
  - _需求: 6.3_

- [x] 12.2 生词表操作功能
  - 实现生词的添加逻辑（从翻译窗口）
  - 创建生词的删除和批量删除功能
  - 实现生词的标记已掌握功能
  - 创建生词的编辑功能
  - _需求: 6.1, 6.5_

- [x] 12.3 生词表导出功能
  - 实现 CSV 格式导出功能
  - 实现 TXT 格式导出功能
  - 创建导出选项和文件保存对话框
  - 处理导出过程中的错误情况
  - _需求: 6.4_

- [x] 13. 主题系统实现
- [x] 13.1 主题切换基础设施
  - 创建主题配置文件（浅色/深色）
  - 实现主题切换的全局状态管理
  - 创建主题应用的 CSS 变量系统
  - _需求: 9.1, 9.2_

- [x] 13.2 响应式布局和适配
  - 实现窗口大小变化的响应式处理
  - 创建不同屏幕尺寸的布局适配
  - 实现工具栏的显示/隐藏切换
  - 处理系统主题偏好的自动检测
  - _需求: 9.3, 9.4, 9.5_

- [x] 14. 性能优化实现
- [x] 14.1 启动性能优化
  - 实现应用启动时的延迟加载
  - 创建最近阅读书籍的缓存预热
  - 优化静态资源的加载和压缩
  - _需求: 10.1_

- [x] 14.2 内存和渲染优化
  - 实现大文件的分页加载机制
  - 创建虚拟滚动组件用于长列表
  - 实现 React 组件的性能优化（memo、useMemo、useCallback）
  - 添加内存使用监控和自动清理
  - _需求: 10.2, 10.3_

- [x] 15. 错误处理和用户反馈
  - 实现全局错误边界组件
  - 创建用户友好的错误提示界面
  - 实现错误日志记录和上报机制
  - 创建加载状态和进度指示器
  - _需求: 1.5, 2.3, 2.5, 5.5, 10.4_

- [x] 16. 测试套件开发
- [x] 16.1 单元测试
  - 为所有服务层编写单元测试
  - 为 React 组件编写测试用例
  - 为工具函数和解析器编写测试
  - 配置测试覆盖率报告
  - _需求: 10.4, 10.5_

- [x] 16.2 集成测试和 E2E 测试
  - 编写 IPC 通信的集成测试
  - 创建数据库操作的集成测试
  - 使用 Playwright 编写端到端测试
  - 创建性能测试和内存泄漏检测
  - _需求: 10.1, 10.2, 10.3, 10.5_

- [ ] 17. 应用打包和分发
  - 配置 Electron Builder 进行应用打包
  - 创建 Windows、macOS、Linux 的构建配置
  - 实现应用签名和自动更新机制
  - 创建安装包和便携版本
  - _需求: 10.5_

- [x] 18. 最终集成和优化
  - 集成所有功能模块并进行端到端测试
  - 进行性能调优和内存优化
  - 修复集成过程中发现的问题
  - 完善用户文档和使用说明
  - _需求: 10.1, 10.2, 10.3, 10.4, 10.5_